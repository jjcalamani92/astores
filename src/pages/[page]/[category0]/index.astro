---
export const prerender = true;

import Layout from "../../../layouts/Layout.astro";
import { url, v, uid, type } from "../../../utils/const";
import { getPaths } from "../../../utils/function";
import type { Page } from "../../../interfaces/page";
import type { Category } from "../../../interfaces/category";
import ListCategoryW0 from "../../../components/ListCategoryW0.astro";
import type { Paths } from "@interfaces/paths";
import type { Site } from "@interfaces/site";
import ListCategoryP0 from "@components/ListCategoryP0.astro";
import ListArticlesP0 from "@components/ListArticlesP0.astro";
import ListProductH0 from "@components/ListProductH0.astro";
import type { Product } from "@interfaces/product";

const params = Astro.params;

export async function getStaticPaths() {
	

	const categories0: Category[] = await fetch(
		`${url}/api/${v}/${type}/query/categories/0/category/siteId?id=${uid}`
	).then((response) => response.json());

	// console.log('categories', categories0.filter((page) => page.data.type !== 'product' ))
	
	// console.log('idssa', idss)
	const categories1: Category[] = await fetch(
		`${url}/api/${v}/${type}/query/categories/1/category/siteId?id=${uid}`
	).then((response) => response.json());

	function getCategories (id: string) {
		return categories1.filter(
			(category) => category.parentId === id
		);
	}
	

		return categories0.filter((page) => page.data.type !== 'product' ).map((category0) => ({
			params: {
				page: category0.data.params.path[0],
				category0: category0.data.params.path[1],
			},
			props: { category: category0, categories: getCategories(category0._id) },
		}));
	
}
const { category, categories } = Astro.props;

// const site: Site = await fetch(
// 	`${url}/api/${v}/${type}/query/sites/${uid}`
// ).then((response) => response.json());
// const category: Category = await fetch(
// 	`${url}/api/${v}/${type}/query/categories/0/category/${uid}/${getPaths(
// 		params as any
// 	)}`
// ).then((response) => response.json());
if (!category) return Astro.redirect("/404");
// const categories: Category[] = await fetch(
// 	`${url}/api/${v}/${type}/query/categories/1/category/parentId?id=${category._id!}`
// ).then((response) => response.json());
// const articles = await fetch(
// 	`${url}/api/${v}/${type}/query/articles/article/parentId?id=${category._id!}`
// ).then((response) => response.json());
// const products: Product[] = await fetch(
// 	`${url}/api/${v}/${type}/query/products/product/parentId?id=${category._id!}`
// ).then((response) => response.json());
// console.log('categories', categories)
---

<Layout
	title={category.data.name}
	description={category.data.description}
	ogImage={category.data.thumbnailUrl}
>
	<main>
		{
			type.includes("portfolio") && (
				<ListCategoryP0 page={category} categories={categories} />
			)
		}
		{
			type.includes('wear') && 
			<ListCategoryW0 page={category} categories={categories} />
		}
	</main>
</Layout>
