---
import Layout from "../../../../../layouts/Layout.astro";
import { url, v, uid, type } from "../../../../../utils/const";
import { getPaths } from "../../../../../utils/function";
import type { Category } from "../../../../../interfaces/category";
import type { Product } from "../../../../../interfaces/product";
import CategoryPreviewsW0 from "../../../../../components/CategoryPreviewsW0.astro";
import ProductPreviewsW0 from "../../../../../components/ProductPreviewsW0.astro";
import type { Site } from "../../../../../interfaces/site";
import CategoryPreviewsP0 from "../../../../../components/CategoryPreviewsP0.astro";
import ArticlesPreviewsP0 from "../../../../../components/ArticlesPreviewsP0.astro";

const params = Astro.params;
const site: Site = await fetch(
	`${url}/api/${v}/${type}/query/sites/${uid}`
).then((response) => response.json());
const category: Category = await fetch(
	`${url}/api/${v}/${type}/query/categories/2/category/${uid}/${getPaths(
		params as any
	)}`
).then((response) => response.json());
if (!category) return Astro.redirect("/404");
const categories: Category[] = await fetch(
	`${url}/api/${v}/${type}/query/categories/3/category/parentId?id=${category._id!}`
).then((response) => response.json());
const products: Product[] = await fetch(
	`${url}/api/${v}/${type}/query/products/product/parentId?id=${category._id!}`
).then((response) => response.json());
const articles = await fetch(
	`${url}/api/${v}/${type}/query/articles/article/parentId?id=${category._id!}`
).then((response) => response.json());
// console.log('products', products)
---

<Layout
	title={category.data.name}
	description={category.data.description}
	ogImage={category.data.thumbnailUrl}
>
	<main>
		{
			site.data.type === "portfolio" && (
				<>
					{category.data.type === "category" && (
						<CategoryPreviewsP0 page={category} categories={categories} />
					)}
					{category.data.type === "blog" && (
						<ArticlesPreviewsP0 page={category} articles={articles} />
					)}
				</>
			)
		}
		{
			site.data.type === "wear" && (
				<>
					{category.data.type === "category" && (
						<CategoryPreviewsW0 page={category} categories={categories} />
					)}
					{category.data.type === "product" && (
						<ProductPreviewsW0 page={category} products={products} />
					)}
				</>
			)
		}
	</main>
</Layout>
